<!DOCTYPE html>
<html>
<head>
    <title>ClosedXML.TableReader</title>
</head>
<body>

    <h1 id="closedxml.tablereader">ClosedXML.TableReader</h1>
<p>ClosedXml is an amazing .NET library to manage Excel files based on <a href="https://es.wikipedia.org/wiki/Office_Open_XML">OpenXML Standard</a>. This component drastically reduces the complexity of working with <a href="https://www.microsoft.com/en-us/download/details.aspx?id=30425">Open XML SDK</a></p>
<p><strong>ClosedXML.TableReader</strong> extends ClosedXML to read Excel tables in typed way. You can read all or some columns, apply transformation rules for each field, refer column by title or name using DataAnotations.</p>
  <br>
<h2 id="read-table-using-conventions">Read Table (using conventions)</h2>
<p>By default, library read table from first column and row used and assume that columns titles are in first row.
For this sample we have next Excel table:</p>
<p><img src="./images/SimpleTable.png?raw=true" alt="" /></p>
<p>We define this VO class:</p>
<pre><code class="language-csharp">
  public class SimpleTable
    {
        public int Number { get; set; } 

        public string Name { get; set; }

        public DateTime ADate { get; set; }

    }
</code></pre>
<p>And we could read table</p>
<pre><code class="language-csharp">  byte[] file = System.IO.File.ReadAllBytes([ExcelPath])

            var wb = new ClosedXML.Excel.XLWorkbook(new MemoryStream(file));

            IEnumerable&lt;SimpleTable&gt; data = wb.ReadTable&lt;SimpleTable&gt;(1); // indicate excel sheet
</code></pre>
<blockquote>
<p>We have to indicate number of sheet where is the table. (First Excel document sheet is number 1)</p>
</blockquote>
<p><br>  <br></p>
<h2 id="data-anotations">Data Anotations</h2>
<p>Title columns used to more complex that <em>Number, Name or ADate</em> and might not match with our properties name conventions. In this case can use DataAnnotations to pair column with object field.</p>
<p>For example, next Excel shows a new column with title <em>Birthday date</em>
<img src="./images/DataAnotations.png?raw=true" alt="" /></p>
<p>We pair with field using standard DisplayName Annotation</p>
<pre><code class="language-csharp">
  public class SimpleTable
    {
        public int Number { get; set; } 

        public string Name { get; set; }

        [DisplayName(&quot;Birthday date&quot;)]
        public DateTime ADate { get; set; }

    }
</code></pre>
  <br>
<h4 id="use-anotations-to-read-table-without-title">Use anotations to read table without title</h4>
<p>We can used DataAnnotations to refer columns without titles, in this case we have to use builtin custom annotation <strong>ColumnName</strong></p>
<p>For Example, for this Excel Table
<img src="./images/SimpleTableWithOutTitles.png?raw=true" alt="" /></p>
<p>We have to modify VO class like that</p>
<pre><code class="language-csharp">
  public class SimpleTable
    {
        [ColumnName(&quot;B&quot;)]
        public int Number { get; set; } 

        [ColumnName(&quot;C&quot;)]
        public string Name { get; set; }

        [ColumnName(&quot;D&quot;)]
        public DateTime ADate { get; set; }

    }
</code></pre>
  <br>
<p><strong><em>Don't forget say library that first row isn't a title in ReadOptions</em></strong></p>
<pre><code class="language-csharp">  var data = wb.ReadTable&lt;SimpleTable&gt;(1,
                new ReadOptions()
                {
                    TitlesInFirstRow = false
                });
</code></pre>
<h2 id="data-transformations">Data transformations</h2>
<p>Optionally, we can make transformations over data before populate in memory object. We can indicate an <em>Expression (per field)</em> for transform any data from Excel cell to adapt to target type</p>
<p><img src="./images/Transformations.png?raw=true" alt="" /></p>
<p>For example, we have column selected in Excel document with a ‘x’ mark and we want transform this data in Boolean value.</p>
<pre><code class="language-csharp">
            //Example with trasnformations
            Expression&lt;Func&lt;string, DateTime&gt;&gt; fConvertData = _ =&gt; DateTime.Now.AddDays(10);
            Expression&lt;Func&lt;string, bool&gt;&gt; fSelectToBool = c =&gt; c == &quot;x&quot;;

            var ls = wb.ReadTable&lt;Models.TableWithHeadersAndBoleanConversion&gt;(1,
                new ReadOptions()
                {
                    TitlesInFirstRow = true,
                    Converters = new Dictionary&lt;string, LambdaExpression&gt;()
                    {
                        {nameof(SimpleTable.ADate),fConvertData },
                        {nameof(SimpleTable.Selected),fSelectToBool },
                    }
                });
</code></pre>
<p>As show, we can transform any value from source.</p>
<ul>
<li>Expression are defined in <strong>ReadOptions.Converters</strong> dictionary.</li>
<li>Dictionary entry key should be object field name, obviusly we can use <em>nameof</em>  for that</li>
</ul>


</body>
</html>